# ───────────────────────────────────────────────
# Definimos un par de mapas para los headers
# ───────────────────────────────────────────────
map $arg_mockup $cache_control_header {
    default        "public, max-age=31536000";
    "true"         "no-store, no-cache, must-revalidate, max-age=0";
}
map $arg_mockup $pragma_header {
    default "";
    "true" "no-cache";
}
map $arg_mockup $expires_header {
    default "";
    "true" "0";
}

server {
    listen       80;
    server_name  localhost;

    root   /usr/share/nginx/html;
    index  index.html index.htm;

    # ───────────────────────────────────────────────
    # Aplicar siempre estos headers, el valor viene
    # de los `map` anteriores según ?mockup=true
    # ───────────────────────────────────────────────
    add_header Cache-Control $cache_control_header always;
    add_header Pragma        $pragma_header         always;
    add_header Expires       $expires_header        always;

    # ───────────────────────────────────────────────
    # Rutas de la SPA (Vue). Con try_files
    # ───────────────────────────────────────────────
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ───────────────────────────────────────────────
    # Archivos estáticos sin cambios (ni cache bust)
    # ───────────────────────────────────────────────
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        try_files $uri =404;
    }

    # ───────────────────────────────────────────────
    # Página de error
    # ───────────────────────────────────────────────
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
